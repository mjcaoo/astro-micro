---
title: "colcon 工具详细使用方法"
description: "全面解析 ROS 2 核心构建工具 colcon 的使用指南。涵盖从安装配置、工作空间创建到编译测试的完整工作流，提供常用命令速查表及依赖缺失、环境变量等常见问题的解决方案。"
date: "2026-01-14"
---

colcon 是 ROS 2（Robot Operating System 2）生态中核心的构建工具，替代了 ROS 1 中的 catkin_make，能高效管理多包项目的构建、测试和安装流程。本文将从基础认知、安装步骤、核心使用流程、常用命令详解及常见问题解决等方面，全面介绍其使用方法。

## 一、colcon 基础认知

colcon（Common Build System for ROS）是一款跨平台的构建工具，其核心优势如下：

- 自动解析 ROS 包之间的依赖关系，按依赖顺序构建，避免手动处理依赖的繁琐操作；

- 支持多种构建系统（CMake、Python setuptools、ament 等），适配不同类型的 ROS 包开发；

- 支持并行构建，大幅提升构建效率，同时输出结构化日志，便于调试排查问题；

- 兼容 ROS 2 的所有发行版（Foxy、Galactic、Humble、Iron 等），具有良好的兼容性和稳定性。

## 二、colcon 安装步骤

colcon 主要支持 Ubuntu 系统（ROS 主流运行环境）和跨平台的 Python pip 安装两种方式，以下是详细步骤：

### 2.1 Ubuntu 系统安装（推荐）

适用于 Ubuntu 18.04 及以上版本，步骤简单且能更好地适配 ROS 2 环境：

```bash
# 更新软件源，确保包信息最新
sudo apt update

# 安装 colcon 核心包及扩展功能
sudo apt install python3-colcon-common-extensions

# 验证安装是否成功（查看版本信息）
colcon --version
```

### 2.2 Python pip 安装（跨平台）

适用于 Windows、macOS 等非 Ubuntu 系统，或需要自定义安装的场景：

```bash
# 先升级 pip 工具，避免安装过程中出现兼容性问题
python3 -m pip install --upgrade pip

# 安装 colcon 核心包及扩展功能
python3 -m pip install -U colcon-common-extensions

# 验证安装是否成功
colcon --version
```

## 三、colcon 核心使用流程（以 ROS 2 工作空间为例）

colcon 的核心使用围绕 ROS 2 工作空间展开，标准流程分为“创建工作空间→构建工作空间→激活工作空间→运行/测试包”四个步骤，具体如下：

### 3.1 创建并进入工作空间

ROS 2 工作空间通常包含 src 目录（存放源码包）、build 目录（构建产物）、install 目录（安装文件）和 log 目录（日志文件），其中 src 目录需要手动创建：

```bash
# 创建工作空间目录（推荐命名为 ros2_ws，可自定义）
mkdir -p ~/ros2_ws/src

# 进入工作空间根目录（后续所有 colcon 命令均在此目录执行）
cd ~/ros2_ws
```

说明：src 目录是存放所有 ROS 包源码的核心目录，工作空间根目录是执行 colcon 命令的唯一有效位置。

### 3.2 构建工作空间（核心命令）

构建是 colcon 的核心功能，通过 `colcon build` 命令可自动解析 src 目录下所有包的依赖关系，并按顺序完成构建。同时支持多种参数自定义构建过程，常用命令及参数如下：

```bash
# 基础构建：自动解析 src 下所有包的依赖并完成构建
colcon build

# 常用参数详解（开发必备）
# 1. 指定单个包构建（避免全量构建，提升效率，推荐日常开发使用）
colcon build --packages-select <包名>  # 示例：colcon build --packages-select demo_nodes_cpp

# 2. 软链接安装（修改 Python 文件、launch 文件、配置文件后无需重新构建，开发效率神器）
colcon build --symlink-install

# 3. 传递 CMake 参数（如指定编译类型为 Release，优化运行性能）
colcon build --cmake-args -DCMAKE_BUILD_TYPE=Release

# 4. 限制并行构建进程数（避免 CPU 占用过高，适用于性能较弱的设备）
colcon build --parallel-workers 2  # 示例：使用 2 个进程进行构建

# 5. 跳过测试构建（加快构建速度，适用于开发调试阶段）
colcon build --cmake-args -DBUILD_TESTING=OFF
```

### 3.3 激活工作空间

构建完成后，需要激活工作空间，将安装目录下的环境变量加载到当前终端，才能正常使用构建好的 ROS 包。激活命令根据终端类型略有差异：

```bash
# bash 终端（绝大多数 Ubuntu 系统默认终端）
source install/setup.bash

# zsh 终端（若使用 zsh 作为默认终端）
source install/setup.zsh

# 验证激活是否成功（查看 ROS 包路径环境变量）
echo $ROS_PACKAGE_PATH
```

说明：每次新开终端都需要重新执行激活命令。若希望永久激活，可将激活命令添加到终端配置文件中：

```bash
# 对于 bash 终端
echo "source ~/ros2_ws/install/setup.bash" >> ~/.bashrc
source ~/.bashrc

# 对于 zsh 终端
echo "source ~/ros2_ws/install/setup.zsh" >> ~/.zshrc
source ~/.zshrc
```

### 3.4 运行/测试包

激活工作空间后，即可通过 ROS 2 命令运行包，或通过 colcon 命令测试包的正确性：

```bash
# 运行 ROS 2 节点（示例：运行 C++ 版本的 talker 节点）
ros2 run demo_nodes_cpp talker

# 运行所有包的测试用例
colcon test

# 只运行指定包的测试用例（提升测试效率）
colcon test --packages-select <包名>  # 示例：colcon test --packages-select demo_nodes_py

# 查看测试结果（简要信息）
colcon test-result

# 查看详细测试结果（含失败原因，便于调试）
colcon test-result --verbose
```

## 四、colcon 常用命令详解

除核心的 build、test、test-result 命令外，colcon 还提供了多个实用命令，用于查看包信息、清理构建产物、生成依赖图等，具体如下表所示：

| 命令                                 | 核心作用                                                   | 示例                                                         |
| ------------------------------------ | ---------------------------------------------------------- | ------------------------------------------------------------ |
| colcon list                          | 列出工作空间中所有包的名称、路径及依赖关系                 | colcon list                                                  |
| colcon info `<包名> `                  | 查看指定包的详细信息（描述、依赖、构建类型等）             | colcon info demo_nodes_py                                    |
| colcon clean                         | 清理构建产物，可指定清理范围（build、install、log）        | colcon clean build（仅清理 build 目录）colcon clean all（清理所有构建相关目录） |
| colcon graph                         | 生成包依赖关系图（需提前安装 graphviz 工具）               | colcon graph --dot                                           |
| colcon build --packages-up-to `<包名>` | 构建指定包及其所有依赖包（适用于需验证依赖包完整性的场景） | colcon build --packages-up-to rviz2                          |

说明：使用 `colcon graph` 命令前，需先安装 graphviz 工具，命令为 `sudo apt install graphviz`（Ubuntu 系统）。

## 五、常见问题与解决方法

在使用 colcon 过程中，常见问题主要集中在依赖缺失、激活失败、构建报错等场景，以下是具体问题及解决方案：

### 5.1 构建失败：依赖缺失

- 现象：构建过程中提示“Could not find ament_cmake”“Could not find xxx package”等依赖相关错误；

- 解决方案：通过 rosdep 工具自动安装缺失的依赖，命令如下：
      `rosdep install --from-paths src --ignore-src -r -y`说明：--from-paths src 表示从 src 目录解析依赖，--ignore-src 表示忽略 src 目录下的源码包，-r 表示忽略无法安装的依赖，-y 表示自动确认安装。

### 5.2 激活后找不到包

- 现象：执行 ros2 run 命令时提示“Package 'xxx' not found”；

- 原因：未在工作空间根目录激活，或构建过程失败导致包未生成；

- 解决方案：
        

  1. 回到工作空间根目录（~/ros2_ws），重新执行激活命令：`source install/setup.bash`；

  2. 查看 log 目录下的构建日志，排查构建失败原因，重新执行 `colcon build` 完成构建。

### 5.3 --symlink-install 不生效

- 现象：使用 --symlink-install 参数构建后，修改 Python 文件仍需重新构建；

- 原因：--symlink-install 仅对 Python 文件、launch 文件、配置文件等文本类文件生效，C++ 代码修改后仍需重新构建；

- 解决方案：C++ 代码修改后，执行 `colcon build --packages-select <包名>` 重新构建指定包即可。

## 六、总结

colcon 工具的核心使用流程可概括为“创建工作空间→构建→激活→运行/测试”，关键要点如下：

1. 核心流程：mkdir -p ~/ros2_ws/src → cd ~/ros2_ws → colcon build（推荐加 --symlink-install）→ source install/setup.bash → 运行/测试包；

2. 高效技巧：日常开发中使用 --packages-select 指定单个包构建，避免全量构建；Python 开发优先使用 --symlink-install 提升效率；

3. 关键注意：每次新开终端需激活工作空间；构建失败优先检查依赖和 log 目录的构建日志。